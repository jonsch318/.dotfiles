# Check if is interactive-session i.e. fish should be started in zellij
if [[ $(ps --no-header --pid=$PPID --format=comm) != "fish" && -z ${BASH_EXECUTION_STRING} && -z ${ZELLIJ} && -z ${virtme_hostname} ]]; then
  shopt -q login_shell && LOGIN_OPTION='--login' || LOGIN_OPTION=''
  export SHELL="/usr/bin/fish"

  # Start Zellij - let it use the default shell command from config
  if [[ "$ZELLIJ_AUTO_ATTACH" == "true" ]]; then
    exec zellij attach -c
  else
    exec zellij
  fi
fi

# If already inside Zellij, start fish
if [[ -n "$ZELLIJ" ]]; then
  shopt -q login_shell && LOGIN_OPTION='--login' || LOGIN_OPTION=''
  exec fish $LOGIN_OPTION
fi

if [[ -n $virtme_hostname ]]; then
  exec sudo -s
fi
